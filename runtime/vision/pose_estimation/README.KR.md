# 자세 추정 모델 추론

이 튜토리얼은 Mobilint qb 런타임을 사용하여 컴파일된 자세 추정 모델로 추론을 실행하는 방법에 대한 자세한 안내를 제공합니다.

이 가이드는 `mblt-sdk-tutorial/compilation/vision/pose_estimation/README.md`에서 이어집니다. 모델 컴파일이 성공적으로 완료되었고 다음 파일이 준비되어 있다고 가정합니다:

- `./yolo11m-pose.mxq` - 컴파일된 모델 파일

## 사전 요구사항

추론을 실행하기 전에 다음이 준비되어 있는지 확인하세요:

- maccel 런타임 라이브러리 (NPU 가속기 접근 제공)
- 컴파일된 `.mxq` 모델 파일
- Python 패키지: `opencv-python`, `numpy`, `torch`

## 개요

추론 프로세스는 `inference_mxq.py` 스크립트에 구현되어 있습니다. 이 스크립트는 다음을 수행하는 방법을 보여줍니다:

- maccel 런타임을 사용하여 컴파일된 `.mxq` 모델 로드
- 입력 이미지 전처리 (리사이즈, 패딩, 정규화)
- NPU 가속기에서 추론 실행
- 출력 후처리 (바운딩 박스 좌표와 키포인트로 변환, 신뢰도 임계값으로 탐지 결과 필터링, 비최대 억제 적용)
- 결과 시각화 (바운딩 박스, 레이블, 키포인트 및 골격 연결선 그리기)

## 추론 실행

예제 추론 스크립트를 실행하려면:

```bash
python inference_mxq.py --model_path ../../../compilation/vision/pose_estimation/yolo11m-pose.mxq --image_path ../rc/cr7.jpg --output_path tmp/cr7.jpg --conf_thres 0.25 --iou_thres 0.45
```

**이 명령이 수행하는 작업:**

- 컴파일된 `.mxq` 모델을 NPU 가속기에 로드
- 입력 이미지를 로드하고 전처리 (YOLO 전처리: 종횡비 유지하며 640x640으로 리사이즈, 회색 테두리로 패딩, [0, 1] 범위로 정규화)
- NPU 가속기에서 추론 실행
- 출력 후처리 (원시 예측값을 바운딩 박스 좌표와 키포인트로 변환, 신뢰도 임계값으로 탐지 결과 필터링, 비최대 억제 적용)
- 이미지에 바운딩 박스, 레이블, 키포인트 및 골격 연결선을 그려 결과 시각화

**매개변수:**

- `--model_path`: 컴파일된 `.mxq` 모델 파일 경로
- `--image_path`: 입력 이미지 경로
- `--output_path`: 출력 이미지를 저장할 경로 (선택사항, 기본값: 입력 이미지와 같은 디렉토리의 `output.jpg`)
- `--conf_thres`: 탐지 결과 필터링을 위한 신뢰도 임계값 (기본값: 0.25)
- `--iou_thres`: 비최대 억제를 위한 IoU 임계값 (기본값: 0.45)

**예상 출력:**

스크립트는 자세 추정 결과를 신뢰도 점수와 클래스 레이블과 함께 표시하고, 바운딩 박스와 키포인트가 그려진 출력 이미지를 `tmp/` 디렉토리에 `cr7.jpg`라는 이름으로 저장합니다.
